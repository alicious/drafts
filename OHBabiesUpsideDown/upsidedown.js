colors = [
  "#000000",
  "#03165a", //1=3,22,90
  "#438a18", //2=67,138,24
  "#330ea2", //3=51,14,162
  "#f32b6d", //4=243,43,109
  "#c50c11", //5=197,12,17
  "#23c7ac", //6=35,199,172
  "#8d187d", //7=141,24,125
  "#dc40f7", //8=220,64,247
  "#970bf6", //9=151,11,246
  "#a5b914", //10=165,185,20
  "#cfbc6f", //11=207,188,111
  "#d52b40", //12=213,43,64
  "#aa2e3d", //13=170,46,61
  
  "#110000", //14=17,0,0
  "#9fb6d1", //15=159,182,209
  "#6e6075", //16=110,96,117
  "#041640", //17=4,22,64
  "#86849a", //18=134,132,154
  "#4455c5", //19=68,85,197
];

shafts = 8;
treadles = 8;


// THREADING
var threadingLine = [];
for (var i = 0; i <= 66; i++) {
  threadingLine = threadingLine.concat([1, 2, 3, 4, 3, 2]);
};

threadingLine = threadingLine.slice(1, -1);

for (var i = 0; i < threadingLine.length; i++) {
  threading.push(threadingLine[i]);
  threading.push(plus(threadingLine[i], 4));
}

// TREADLING
var shortTrill = [1, 2, 1, 2, 1, 2, 3, 2, 3, 2, 3, 4, 3, 4, 3, 4, 5, 4, 5, 4];
var longTrill = stretch(3, shortTrill);
var shortStraight = [2, 3, 4];
var longStraight = stretch(2, shortStraight);
var crackle = [1, 2,
               1, 2, 3, 2, 1, 
               2, 3, 4, 3, 2, 3, 4, 
               5, 4, 3, 4, 5,
               4, 5]; 

/*
*/
treadlingLine = repeat(80, [1]);
treadlingLine = treadlingLine.concat(crackle);
treadlingLine = treadlingLine.concat(repeat(80, [5]));

/* treadling sampler
treadlingLine = repeat(30, [1]);
treadlingLine = treadlingLine.concat(crackle);
treadlingLine = treadlingLine.concat(repeat(30, [5]));
treadlingLine = treadlingLine.concat(shortTrill.reverse());
treadlingLine = treadlingLine.concat(repeat(30, [1]));
treadlingLine = treadlingLine.concat(longTrill);
treadlingLine = treadlingLine.concat(repeat(30, [5]));
treadlingLine = treadlingLine.concat(shortStraight.reverse());
treadlingLine = treadlingLine.concat(repeat(30, [1]));
treadlingLine = treadlingLine.concat(longStraight);
treadlingLine = treadlingLine.concat(repeat(30, [5]));
*/

treadling = buildTaqueteTreadling(treadlingLine);

treadles = 10

// TIEUP
tieup = build8ShaftTaqueteTieup();

// COLORPLAN

var sw1 = [1,1,1,1,1,1,1,2,1,1,1,3,2,1,1,3,3,1,2,3,3,4,2,5,4,3,2,6,7,3,3,4,4,1,3,4,3,4,5,4,2,3,4,4,2,3,3,2,4,2,4,3,3,3,4,1,3,3,3,3,3,7,2,4,1,3,2,1,3,4,1,1,4,1,1,5,3,4,1,3,1,2,1,8,3,3,1,3,7,1,4,3,3,9,2,3,2,9,8,3,3,1,8,4,3,6,4,5,2,7,1,1,4,3,4,3,4,3,4,3,8,4,3,2,8,8,8,3,9,9,4,4,3,3,4,3,8,3,2,6,3,3,5,7,8,4,2,7,4,4,4,1,8,3,1,5,4,3,1,3,3,9,7,9,7,9,3,3,3,2,3,3,3,4,2,1,5,1,1,3,2,8,5,8,4,1,4,8,9,3,8,1,9,1,5,3,4,3,1,7,7,7,4,1,4,3,3,4,3,3,1,10,2,9,4,9,3,3,3,3,3,3,1,3,3,3,1,8,9,8,4,7,5,8,8,3,3,4,8,7,8,4,7,1,3,3,3,5,11,6,4,6,6,10,5,7,2,1,3,3,9,3,9,4,3,4,7,3,7,3,4,2,3,9,7,1,4,8,3,7,4,4,3,7,1,7,8,6,4,9,3,8,3,3,5,1,3,9,1,3,7,2,5,2,9,3,7,5,2,3,1,1,5,8,3,4,7,6,7,4,4,4,8,6,7,1,8,7,3,8,3,3,6,1,8,9,1,8,3,6,9,1,3,10,1,1,9,7,3,1,2,3,4,3,9,3,7,5,3,4,9,8,5,4,3,2,9,1,5,3,9,7,9,9,7,5,4,3,7,9,3,4,6,5,1,7,8,3,6,7,11,1,5,1,3,3,8,3,6,8,4,9,4,7,3,6,3,6,7,1,7,3,3,6,10,7,6,1,7,5,2,3,9,5,8,4,7,4,3,1,9,7,3,3,9,11,7,9,3,4,1,5,3,1,1,5,7,7,8,6,11,1,3,5,5,7,3,3,9,5,1,7,7,12,12,3,4,9,7,9,11,9,5,7,9,7,1,7,4,5,2,7,9,11,1,7,7,5,3,5,7,9,7,5,3,4,4,3,6,7,3,8,6,9,1,9,9,7,7,9,8,5,3,4,1,12,7,5,5,7,8,7,8,8,5,3,1,9,1,7,7,9,10,7,7,6,3,11,5,2,4,7,8,7,5,3,3,7,7,6,6,5,4,3,6,9,7,4,3,9,8,5,6,5,5,7,7,5,4,5,3,9,7,6,7,8,7,7,7,7,8,5,9,7,3,1,9,7,1,7,6,5,3,5,5,3,7,1,7,6,3,1,4,7,7,6,4,9,9,5,5,5,5,7,8,1,7,7,7,9,5,9,6,3,9,5,6,1,3,5,5,12,12,12,5,5,6,4,7,5,4,7,5,5,8,7,5,10,7,6,10,3,3,12,4,4,5,12,7,6,7,3,7,3,4,5,6,7,7,3,12,3,7,1,7,5,7,5,5,5,5,8,5,7,5,7,7,5,7,12,5,7,3,7,7,12,7,10,5,4,5,3,3,6,7,7,12,12,5,10,4,1,11,3,7,7,3,7,5,5,3,5,7,3,7,4,5,13,7,5,3,8,4,7,7,7,5,5,4,12,8,12,10,5,7,12,12,5,5,5,7,5,12,7,7,7,5,7,7,7,11,12,5,5,12,5,7,7,5,4,7,7,5,10,12,5,12,12,5,10,7,12,5,7,7,12,13,7,7,7,12,13,5,12,13,5,5,5,12,7];

var sw2 = [14,14,14,14,14,14,14,14,15,14,14,14,14,14,15,14,14,16,14,14,14,14,16,14,14,16,16,16,14,16,14,14,14,14,14,15,14,14,14,14,14,14,14,15,14,17,14,16,14,18,14,14,14,18,18,14,14,15,16,14,14,16,14,14,14,14,14,17,15,18,18,18,14,18,16,18,18,14,17,14,18,18,18,18,18,18,15,14,14,18,14,14,18,14,14,14,16,14,17,16,18,14,16,18,16,16,16,14,16,18,16,18,14,14,17,18,18,14,14,18,14,14,14,18,18,14,14,14,18,14,16,18,18,15,14,15,15,18,14,18,14,18,14,18,14,14,18,18,14,14,14,18,16,14,14,14,16,16,14,15,16,18,18,14,14,18,14,16,17,14,16,18,14,15,17,15,16,18,16,14,16,16,16,18,18,18,14,14,14,18,18,18,14,14,18,15,16,15,15,14,14,17,14,18,14,14,14,14,15,16,17,14,18,16,16,15,14,16,14,16,14,14,17,14,14,14,16,16,16,18,18,14,18,18,14,14,16,17,14,14,18,18,18,16,14,16,16,18,16,16,16,14,14,14,17,17,18,14,16,18,14,16,14,16,15,15,15,14,18,16,18,14,14,16,17,14,19,16,18,18,18,14,18,14,14,18,14,14,18,14,18,16,14,18,14,16,18,14,16,15,16,14,18,14,14,14,18,15,17,18,17,15,15,16,16,15,18,16,15,14,18,14,19,16,14,14,14,18,16,18,15,14,16,14,14,14,14,15,18,17,14,19,18,14,14,16,14,16,15,17,14,18,18,19,18,18,17,19,16,16,19,14,18,14,14,19,18,19,14,17,18,17,18,17,16,15,15,18,18,18,18,14,16,15,14,17,14,14,18,16,15,15,14,18,14,14,15,16,18,17,17,17,14,14,18,14,17,15,19,14,15,18,14,15,14,15,15,19,18,18,16,18,14,15,15,16,17,18,18,17,18,16,18,17,14,18,18,14,17,16,17,15,14,14,15,16,14,15,17,17,18,15,18,14,15,18,18,16,16,16,15,14,18,16,16,18,18,17,16,17,16,15,17,15,17,17,18,16,18,18,18,18,18,14,14,17,15,17,14,18,17,15,18,15,14,18,17,15,18,17,17,15,14,17,15,15,17,16,14,18,17,18,18,18,17,18,16,18,18,16,17,16,16,15,18,14,14,19,15,14,15,18,19,18,17,19,18,14,14,17,14,19,15,17,15,14,17,14,17,18,19,17,16,15,16,14,14,18,17,16,18,15,15,18,19,17,15,18,18,18,18,14,16,14,14,18,19,18,17,19,14,17,18,14,15,17,15,19,16,15,16,16,14,19,16,19,14,17,14,14,18,16,19,19,17,14,17,18,18,15,14,18,14,15,14,17,16,17,14,18,19,17,15,14,18,19,16,18,15,14,15,14,15,15,15,18,15,18,17,19,16,19,15,18,14,15,17,18,16,15,15,19,16,14,16,15,14,19,14,17,15,15,15,16,15,15,14,15,15,18,14,16,15,15,17,18,18,19,15,19,14,15,19,17,14,18,19,18,15,18,15,15,15,18,19,16,18,17,17,19,15,17,15,14,16,17,15,15,15,16,16,19,19,18,14,15,18,17,17,17,14,17,15,19,16,18,18,17,19,15,15,16,19,14,17,19,16,18,19,16,16,14,15,18,18,19,17,18,15,17,16,19,16,16,18,14,17,15,18,17,17,18,15,16,17,17,16,17,15,19,19,17,16,15,17,15,15,18,14,18,17,19,19,19,18,16,16,18,18,19,16,16,17,19,15,16,19,19,17,15];

var dsw1 = [];
var dsw2 = [];

for (var i = 0; i < 400; i++) {
  threads.push(sw1[i*2]);
  dsw1.push(sw1[i*2]);
  threads.push(sw2[i*2]);
  dsw2.push(sw2[i*2]);
}

threads = dsw1.concat(dsw2); //subwarp preview

for (var i = 0; i < treadling.length; i++) {
  weftThreads.push(16);
}
logWif();


//FUNCTIONS

function blendBouts (blendScheme, bout1, bout2) {
 
  var result = [];
  
  for (var i = 0; i < blendScheme.length; i++) {
    var bout1times = blendScheme[blendScheme.length - (i+1)];
    var bout2times = blendScheme[i];
    for (var j = 0; j < bout1times; j++) {
      result = result.concat(bout1);
    }
    for (var j = 0; j < bout2times; j++) {
      result = result.concat(bout2);
    }
  }
  
  return result;
  
}

function buildTaqueteTreadling (line) {
  var taqueteTreadling = [];
  
  for (var i = 0; i < line.length; i++) {
    taqueteTreadling.push(i%2 + 1);
    taqueteTreadling.push(line[i] + 2);
  }
  
  return taqueteTreadling;
}

function build8ShaftTwillTieup (initial) {
  var result = [];
  
  for (var i = 0; i < 8; i++) {
    var treadle = [];
    for (var j = 0; j < 4; j++) {
      treadle.push(minus(initial[j], i));
    }
    result.push(treadle);
  }
  
  return result;
}

function build8ShaftTaqueteTieup () {
  var result = [];
  result.push([1, 3, 5, 7]);
  result.push([2, 4, 6, 8]);
  return result.concat(build8ShaftTwillTieup([1, 2, 3, 4]));
}

// BUILT-IN FUNCTIONS
function pointReflect (array) {
  return array.concat(array.slice(0, -1).reverse());
}

function collapse (shafts, line) {
      var result = [];
        for (var i = 0; i < line.length; i++) {
                result.push(((line[i]-1) % shafts) + 1);
                  }
          return result;
}

function plus (x, y) {
      if (y < 0)
              return minus(x, Math.abs(y));
        if ((x < 1) || (x > 8))
                log("unexpected value for x: " + x);
          return (x + y - 1) % 8 + 1;
}

function minus (x, y) {
      if ((x < 1) || (x > 8))
              log("unexpected value for x: " + x);
        return ( (x - 1) + ( 8 - y % 8 ) )% 8 + 1;
}

function buildStraight(length) {
  var result = [];
  for (var i = 1; i <= length; i++) {
    result.push(i);
  }
  return result;
}

